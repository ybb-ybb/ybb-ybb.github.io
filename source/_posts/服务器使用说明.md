---
date: 2020-01-24 11:38:00
description: 服务器使用教程，输入密码查看
title: 服务器使用教程
author: 鱼摆摆
comments: true
tags: 
 - 服务器
photos: https://cn.bing.com/th?id=OIP.h3RRBQ9GAiXgRoiV4kBYaAHaEo&pid=Api&rs=1
password: 123456
categories: 实验室
---
# 服务器使用说明

## 通知公告区

服务器ip：

- 10.7.23.188
- 10.7.31.194
- 10.7.13.35
对应portainer界面地址：
- 10.7.xx.xx:9000
### 公告：
- 已安装的镜像:cuda10:conda，内含anaconda，cuda8及其它版本待安装
- 数据放在服务器的/data目录下，在容器内的位置是/workspace/data
- portainer登录的帐号密码为自己名字首字母，例：ybb
- 请注意尽量将代码和数据集的存储位置分离
- 其它问题connect me

## 使用教程区
### vpn安装
连接服务器需要校园内网环境，在家需要连接[vpn](https://v.dlut.edu.cn/)访问  
目前学校的vpn仅对老师和博士开放，研究生可以找师兄师姐们借个账号  
账号密码为校园门户的账号密码
安装过程详见[Reference](https://its.dlut.edu.cn/index/jsfw/fwzn/VPN/vpn.htm)

### 容器创建
登入portainer界面10.7.××.××:9000  
![](https://i.loli.net/2020/01/17/TS8KR59mgUplPOB.png)
![](https://i.loli.net/2020/01/17/WRPX7kTtM4so6Ka.png)
![](https://i.loli.net/2020/01/17/YkqRPnJ3fVvCamt.png)
输入nvidia-smi查看可用的显卡  
![](https://i.loli.net/2020/01/17/9h238it5kDLVacT.png)
![](https://i.loli.net/2020/01/17/BxM5rIaWsNGimXf.png)
![](https://i.loli.net/2020/01/17/CZr5HvK7hDfQakF.png)
![](https://i.loli.net/2020/01/17/kLZ5uQmDfI8aecR.png)
![](https://i.loli.net/2020/01/17/ap3g1urL8xVSyqF.png)

### 端口开放

![](https://i.loli.net/2020/01/17/4iSh9ZCT5WyDaX1.png)
vim /etc/ssh/sshd_config  
取消Port行的注释，修改为自己的端口号，
***同一台服务器端口号不要重复！***
![](https://i.loli.net/2020/01/17/PgvJyiwIkFj7Hd2.png)



保存后  service  ssh restart

passwd 修改登录密码

![](https://i.loli.net/2020/01/17/WHwyvCMsSrj2XzZ.png)

### 为防止端口号重复，请使用自己的端口
- 罗金铭 1001--- 1050
- 田胜景 1051--- 1100
- 周骏     1101--- 1150
- 谭红臣 1151--- 1200
- 孔雨秋 1201--- 1250
- 陈宝玉 1251--- 1300
- 张怡     1301--- 1350
- 田国强 1351--- 1400
- 王华胜 1401--- 1450
- 王诗瑶 1451--- 1500
- 黄骅     1501--- 1550
- 于冰冰  1551--- 1600
- 卞瑜昊 1601--- 1650
- 薛怡     1651--- 1700
- 肖贺文 1701--- 1750
- 王艺路 1751--- 1800
- 陈心慧 1801--- 1850
- 薛钰洁 1851--- 1900
- 徐子涵 1901--- 1950
- 刘彬     1951--- 2000
### 调用服务器运行程序
**连接：**

```bash
# port为自己的端口号
$ ssh -p port root@10.7.60.40
```

在服务器中用conda建立自己需要的环境，激活环境：  
```bash
$ source activate env_name
```

**文件拷贝:**

可以使用SFTP软件进行文件拷贝：

例如：

windows系统可以使用[winscp](https://winscp.net) ,[sftp](https://filezilla-project.org/) 等

mac系统可以使用[sftp](https://filezilla-project.org/) 或`scp`命令（注：mac下的sftp命令极不友好）

Linux系统下直接使用`sftp`命令即可

```bash
# SCP拷贝文件夹需要添加参数-r
# 电脑中的文件拷贝到容器中，port为端口号
$ scp -P port /dir/filename root@10.7.××.××:/dir
# 容器中的文件拷贝到电脑上
$ scp -P port root@10.7.××.××:/dir/filename /dir
###########################分割线###############################
# 或使用sftp命令，更加方便
$ sftp -p port root@10.7.××.××
# 查看本地目录
$ lpwd
# 查看远程目录
$ pwd
# 查看本地目录下文件及文件夹
$ lls
# 查看远程目录下文件及文件夹
$ ls
# 切换本地目录
$ lcd /dir
# 切换远程目录
$ cd /dir
# 上传文件
$ put file
# 上传文件夹
# put -r dir
```

可以将代码拷贝到服务器内，在容器中用命令运行程序，用vim修改代码或本地改好代码后将代码传到服务器上  

也可以用Pycharm(必须要专业版)同步本地和容器中的代码（实际上使用的sftp协议）

```text
File-->Settings-->Project-->Project InterPreter-->小齿轮-->Add-->SSH Interpreter
```
![](https://i.loli.net/2020/01/17/tTbynhUlrCj74gk.png)
![](https://i.loli.net/2020/01/17/krKMPRG3H1xJCys.png)
![](https://i.loli.net/2020/01/17/PGpJ51vgBfWmuDZ.png)
![](https://i.loli.net/2020/01/17/AOzeFlLaBS4IvrP.png)
![](https://i.loli.net/2020/01/17/kfvGnTdMwAsHOgD.png)
![](https://i.loli.net/2020/01/17/IC1H28iaDRVu5G6.png)

Pycharm连接服务器终端:

```text
Tools-->Start SSH session-->选择
```
![](https://i.loli.net/2020/01/17/Q87Y6SrfHtEDCp4.png)
![](https://i.loli.net/2020/01/17/2pFYIdCS9mLzvQe.png)
![](https://i.loli.net/2020/01/17/m4Zdxnk1wSu2HXG.png)

 ## 附

**关于代码与数据集分离的问题**

一方面是因为docker容器挂载在4T机械硬盘上，将数据集放在2T的固态硬盘上会增加数据集读写速度

另一方面是因为pycharm在打开项目时会将当前目录下的所有文件进行缓存，如果将数据集放在代码文件夹下会产生大量数据集缓存，占用磁盘空间。

另外，不要将代码和生成的模型放在/workspace/data目录下(固态)，会占用大量的磁盘空间。

**关于挂载目录的问题**

默认将宿主机的`/data`目录挂载到容器内的`/workspace`目录用于存储数据

![image](https://cdn.jsdelivr.net/gh/ybb-ybb/gallery/img/image-20200912142211188.png)



**数据集**

尽量不要用服务器下大型数据集，挂的我的网号，流量伤不起/(ㄒoㄒ)/~~

**关于shm-size问题**

shm-size相当于docker中的交换空间，在进行数据读取的时候进行缓存使用，默认为64M(经常不够用)，但没找到很好的portainer中的解决方案。需要更改shm-size直接connect me，一般建一个容器后可以一直用了……

**nohup**

在终端运行实验时，建议使用nouhp命令将输出结果重定向到文本文档


```bash
# 将输出结果重定向到nohup.out文件
$ nohup python main.py &
# 指定文件
$ nohup python main.py >> out.txt &
```

也可以写bash文件运行。

## 有其他问题connect me

## 其他内容待补充
